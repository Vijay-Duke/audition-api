<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AuditionController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">audition-api</a> &gt; <a href="index.source.html" class="el_package">com.audition.web</a> &gt; <span class="el_source">AuditionController.java</span></div><h1>AuditionController.java</h1><pre class="source lang-java linenums">package com.audition.web;

import com.audition.model.AuditionPost;
import com.audition.model.Comment;
import com.audition.model.PostSearchCriteria;
import com.audition.service.AuditionService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;
import io.swagger.v3.oas.annotations.tags.Tag;
import jakarta.validation.Valid;
import jakarta.validation.constraints.Positive;
import java.util.List;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.http.MediaType;
import org.springframework.http.ProblemDetail;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

/**
 * REST controller for audition post and comment operations.
 * Provides endpoints for retrieving posts with optional filtering, pagination, and sorting.
 *
 * &lt;p&gt;API versioning uses URL path strategy: /api/v1/*&lt;/p&gt;
 */
@RestController
@RequestMapping(&quot;/api/v1&quot;)
@Validated
@Tag(name = &quot;Posts&quot;, description = &quot;Operations for managing posts and comments (API v1)&quot;)
public class AuditionController {

<span class="fc" id="L41">    private static final Logger LOG = LoggerFactory.getLogger(AuditionController.class);</span>

    private final AuditionService auditionService;

<span class="fc" id="L45">    public AuditionController(final AuditionService auditionService) {</span>
<span class="fc" id="L46">        this.auditionService = auditionService;</span>
<span class="fc" id="L47">    }</span>

    /**
     * Retrieves a list of posts based on the provided search criteria.
     *
     * @param criteria the search criteria including optional filters (userId, titleContains),
     *                 pagination (page, size), and sorting (sort, order)
     * @return a list of posts matching the criteria, or an empty list if none found
     */
    @Operation(
        summary = &quot;Get posts&quot;,
        description = &quot;Retrieves posts with optional filtering by userId, title search, pagination, and sorting&quot;
    )
    @ApiResponses({
        @ApiResponse(responseCode = &quot;200&quot;, description = &quot;Successfully retrieved posts&quot;),
        @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid request parameters&quot;,
            content = @Content(schema = @Schema(implementation = ProblemDetail.class))),
        @ApiResponse(responseCode = &quot;503&quot;, description = &quot;Upstream service unavailable&quot;,
            content = @Content(schema = @Schema(implementation = ProblemDetail.class)))
    })
    @GetMapping(value = &quot;/posts&quot;, produces = MediaType.APPLICATION_JSON_VALUE)
    public List&lt;AuditionPost&gt; getPosts(@Valid @ModelAttribute final PostSearchCriteria criteria) {
<span class="fc" id="L69">        LOG.debug(&quot;Getting posts with criteria: {}&quot;, criteria);</span>
<span class="fc" id="L70">        final List&lt;AuditionPost&gt; posts = auditionService.getPosts(criteria);</span>
<span class="fc" id="L71">        LOG.debug(&quot;Returning {} posts&quot;, posts.size());</span>
<span class="fc" id="L72">        return posts;</span>
    }

    /**
     * Retrieves a single post by its ID, optionally including its comments.
     *
     * &lt;p&gt;Uses JSON:API style inclusion pattern: {@code ?include=comments}
     * This allows fetching related resources in a single request to reduce round trips.&lt;/p&gt;
     *
     * @param postId the ID of the post to retrieve (must be a positive integer)
     * @param include comma-separated list of related resources to include (supported: &quot;comments&quot;)
     * @return the post with the specified ID
     * @throws com.audition.common.exception.SystemException with status 404 if post not found
     */
    @Operation(
        summary = &quot;Get post by ID&quot;,
        description = &quot;Retrieves a single post by its ID. Use ?include=comments to embed comments in the response.&quot;
    )
    @ApiResponses({
        @ApiResponse(responseCode = &quot;200&quot;, description = &quot;Successfully retrieved post&quot;),
        @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid post ID (must be positive integer)&quot;,
            content = @Content(schema = @Schema(implementation = ProblemDetail.class))),
        @ApiResponse(responseCode = &quot;404&quot;, description = &quot;Post not found&quot;,
            content = @Content(schema = @Schema(implementation = ProblemDetail.class))),
        @ApiResponse(responseCode = &quot;503&quot;, description = &quot;Upstream service unavailable&quot;,
            content = @Content(schema = @Schema(implementation = ProblemDetail.class)))
    })
    @GetMapping(value = &quot;/posts/{id}&quot;, produces = MediaType.APPLICATION_JSON_VALUE)
    public AuditionPost getPostById(
            @Parameter(description = &quot;Post ID&quot;, example = &quot;1&quot;, schema = @Schema(minimum = &quot;1&quot;))
            @PathVariable(&quot;id&quot;) @Positive(message = &quot;Post id must be a positive integer&quot;) final Long postId,
            @Parameter(description = &quot;Related resources to include (e.g., 'comments')&quot;, example = &quot;comments&quot;)
            @RequestParam(value = &quot;include&quot;, required = false) final String include) {
<span class="fc" id="L105">        final boolean includeComments = &quot;comments&quot;.equalsIgnoreCase(include);</span>
<span class="fc" id="L106">        LOG.debug(&quot;Getting post by id: {}, includeComments: {}&quot;, postId, includeComments);</span>
<span class="fc" id="L107">        final AuditionPost post = auditionService.getPostById(postId, includeComments);</span>
<span class="fc" id="L108">        LOG.debug(&quot;Returning post: {}&quot;, post.getId());</span>
<span class="fc" id="L109">        return post;</span>
    }

    /**
     * Retrieves all comments for a specific post.
     *
     * @param postId the ID of the post whose comments to retrieve (must be a positive integer)
     * @return a list of comments for the specified post, or an empty list if none exist
     */
    @Operation(
        summary = &quot;Get comments for post&quot;,
        description = &quot;Retrieves all comments associated with a specific post&quot;
    )
    @ApiResponses({
        @ApiResponse(responseCode = &quot;200&quot;, description = &quot;Successfully retrieved comments&quot;),
        @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid post ID (must be positive integer)&quot;,
            content = @Content(schema = @Schema(implementation = ProblemDetail.class))),
        @ApiResponse(responseCode = &quot;503&quot;, description = &quot;Upstream service unavailable&quot;,
            content = @Content(schema = @Schema(implementation = ProblemDetail.class)))
    })
    @GetMapping(value = &quot;/posts/{postId}/comments&quot;, produces = MediaType.APPLICATION_JSON_VALUE)
    public List&lt;Comment&gt; getCommentsForPost(
            @Parameter(description = &quot;Post ID&quot;, example = &quot;1&quot;, schema = @Schema(minimum = &quot;1&quot;))
            @PathVariable(&quot;postId&quot;) @Positive(message = &quot;Post id must be a positive integer&quot;) final Long postId) {
<span class="fc" id="L133">        LOG.debug(&quot;Getting comments for post: {}&quot;, postId);</span>
<span class="fc" id="L134">        final List&lt;Comment&gt; comments = auditionService.getCommentsForPost(postId);</span>
<span class="fc" id="L135">        LOG.debug(&quot;Returning {} comments for post: {}&quot;, comments.size(), postId);</span>
<span class="fc" id="L136">        return comments;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>